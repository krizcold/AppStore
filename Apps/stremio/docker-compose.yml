name: stremio

services:
  # Proxy container on pcs network - handles mesh-router routing
  stremio:
    image: ghcr.io/yundera/nginx-hash-lock:latest
    container_name: stremio
    restart: unless-stopped
    user: "root"
    expose:
      - 80
    environment:
      BACKEND_HOST: "172.18.0.1"
      BACKEND_PORT: "8080"
      LISTEN_PORT: "80"
    tmpfs:
      - /var/cache/nginx:size=300M
    depends_on:
      - stremiocommunity
    networks:
      - pcs

  # Stremio server on host network - sees real IPv6 for torrent peers
  stremiocommunity:
    image: tsaridas/stremio-docker:latest
    container_name: stremiocommunity
    restart: unless-stopped
    network_mode: host
    user: "0:0"
    # With network_mode: host, ports are directly on host:
    # - 8080: Web UI + Streaming server
    # - 6881: Torrent incoming connections (TCP/UDP)
    environment:
      NO_CORS: "1"
      AUTO_SERVER_URL: "1"
      USERNAME: "admin"
      PASSWORD: "stremio"
    volumes:
      - type: bind
        source: /DATA/AppData/stremio/server/
        target: /root/.stremio-server/
    x-casaos:
      envs:
        - container: USERNAME
          description:
            en_us: "Username for HTTP basic auth"
        - container: PASSWORD
          description:
            en_us: "Password for HTTP basic auth"
      volumes:
        - container: /root/.stremio-server
          description:
            en_us: "Stremio server data and configuration"

networks:
  pcs:
    external: true

x-casaos:
  architectures:
    - amd64
    - arm64
    - arm/v7
  main: stremio
  author: Yundera
  developer: Yundera
  icon: https://www.stremio.com/website/stremio-logo-small.png
  tagline:
    en_us: "Stream movies & series (Community Edition) - POC Host Network"
  category: Entertainment
  description:
    en_us: |
      Stremio Community Edition - PROOF OF CONCEPT with host networking.

      This version uses network_mode: host to test if direct IPv6 access
      improves torrent peer connectivity.

      Architecture:
      - Nginx proxy on pcs network (for mesh-router access)
      - Stremio server on host network (for IPv6 torrent peers)

      Features:
      - Host networking for proper IPv6 peer announcement
      - All-in-one streaming server with FFmpeg transcoding
      - HTTP basic auth (USERNAME/PASSWORD)

      Default credentials: admin / stremio
  title:
    en_us: "Stremio (POC)"
  store_app_id: stremio-poc
  is_uncontrolled: false
  index: /
  webui_port: 80
  tips:
    before_install:
      en_us: |
        PROOF OF CONCEPT - Tests host networking for better torrent peers.

        Access: `https://stremio-${REF_DOMAIN}/`
        Default credentials: `admin` / `stremio`

        Compare peer count with this version vs production to see if
        host networking improves torrent connectivity.
