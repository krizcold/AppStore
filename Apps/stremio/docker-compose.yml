name: stremio

services:
  stremio:
    image: krizcold/nginxhashlock:latest
    container_name: stremio
    restart: unless-stopped
    user: "root"
    privileged: true
    expose:
      - 80
    environment:
      SUBDOMAIN_HASH_ENABLED: "true"
      SUBDOMAIN_HASH_LENGTH: "24"
      SUBDOMAIN_PATTERN: "^([^-]+)-stremio-"
      BACKEND_HASH: "serverhash"
      AUTH_HASH: $AUTH_HASH
      USER: "admin"
      PASSWORD: "stremio"
      BACKEND_HOST: "stremioserver"
      BACKEND_PORT: "11470"
      SECONDARY_BACKEND_HOST: "stremioweb"
      SECONDARY_BACKEND_PORT: "8080"
      LISTEN_PORT: "80"
    depends_on:
      - stremioweb
      - stremioserver
    networks:
      - pcs

  stremioweb:
    image: krizcold/yundera-stremio-webui:latest
    container_name: stremioweb
    restart: unless-stopped
    user: "0:0"
    environment:
      BACKEND_HASH: "serverhash"
      PRESET_URLS: ""
      PRESET_TYPE: "full"
      PRESET_LANGUAGE: "en"
      ENABLE_PRESETS: "true"
      UPDATE_CHECK_HOURS: "24"
      UPDATE_WINDOW_START: "03:00"
      UPDATE_WINDOW_END: "05:00"
      UPDATE_ONLY_IN_WINDOW: "true"
      STREMIO_VERSION: "auto"
      STATICALLY_BASE: "https://cdn.statically.io/gh"
      NGINX_PORT: "8080"
    volumes:
      - type: bind
        source: /DATA/AppData/stremio/web-cache/
        target: /app/cache/
    tmpfs:
      - /var/cache/nginx/
      - /var/run/
    privileged: true
    depends_on:
      - stremioserver
    networks:
      - pcs

  stremioserver:
    image: stremio/server:latest
    container_name: stremioserver
    restart: unless-stopped
    expose:
      - 11470
    environment:
      NO_CORS: "1"
      APP_PATH: "/root/.stremio-server"
      NODE_TLS_REJECT_UNAUTHORIZED: "0"
      INTERNAL_URL: "http://stremioserver:11470"
    volumes:
      - type: bind
        source: /DATA/AppData/stremio/config/
        target: /root/.stremio-server/
    networks:
      - pcs

networks:
  pcs:
    external: true

x-casaos:
  architectures:
    - amd64
    - arm64
  main: stremio
  author: Yundera
  developer: Yundera
  icon: https://www.stremio.com/website/stremio-logo-small.png
  tagline:
    en_us: "Stream movies & series (Yundera Smart Edition)"
  category: Entertainment
  description:
    en_us: "Stremio with Yundera Smart Web UI and subdomain-based server authentication. Features auto-updates, preset addons, and dual authentication for frontend and backend access."
  title:
    en_us: "Stremio Yundera"
  store_app_id: stremioyundera
  is_uncontrolled: false
  index: /?hash=$AUTH_HASH
  webui_port: 80
  tips:
    before_install:
      en_us: |
        Access: `http://stremio-${REF_DOMAIN}/`

        You can change USER/PASSWORD via environment variables on "stremio" service, by default:
        • USER: admin
        • PASSWORD: stremio

        You can change BACKEND_HASH via environment variables on both "stremio" and "stremioweb" services.
        - Note: BACKEND_HASH can only be up to 24 characters long.

        You can set PRESET_URLS for a preset.json file to auto-load addons on first launch for non-logged users.
        • Logged-in users can find addon URLs in the browser console to add them manually.
        • Supports multiple preset sources (comma-separated URLs).

        Features: Auto-updates, zero downtime, subdomain auth, dynamic streaming paths
